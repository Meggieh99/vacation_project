{% extends 'layout.html' %}
{% load static %}
{% block title %}Vacation Admin{% endblock %}

{% block content %}
<h2 class="form-title text-center">Manage Vacations</h2>

<div class="text-center mb-4">
    <a href="{% url 'vacation-add' %}" class="nav-btn nav-vacation">‚ûï Add New Vacation</a>
</div>

<div class="vacation-grid">
   {% for vacation in vacations %}
   <div class="vacation-card">
      <div class="card-image">
         <img src="{% static 'images/' %}{{ vacation.image_filename }}" alt="{{ vacation.country }}">
      </div>

      <div class="card-body">
         <div class="country-name">{{ vacation.country.name }}</div>
         <div class="date-range">{{ vacation.start_date }} - {{ vacation.end_date }}</div>
         <div class="description">{{ vacation.description }}</div>
         <div class="price">${{ vacation.price }}</div>

         <div class="admin-actions mt-2">
            <a class="nav-btn edit-btn" href="{% url 'vacation-edit-form' vacation.id %}">‚úèÔ∏è Edit</a>
            <button class="nav-btn logout-btn delete-btn" data-vacation-id="{{ vacation.id }}">üóëÔ∏è Delete</button>
         </div>
      </div>
   </div>
   {% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const deleteButtons = document.querySelectorAll('.delete-btn');

    deleteButtons.forEach(button => {
        button.addEventListener('click', function () {
            const vacationId = this.dataset.vacationId;
            if (confirm("Are you sure you want to delete this vacation?")) {
                fetch(`/vacations/${vacationId}/delete/`, {
                    method: 'DELETE',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    },
                    credentials: 'include'
                }).then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        response.json().then(data => {
                            alert("Error: " + (data.error || "Something went wrong"));
                        });
                    }
                }).catch(err => alert("Error: " + err));
            }
        });
    });

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});
</script>
{% endblock %}
